// Generated by CoffeeScript 1.4.0

/**
 * @package     CleverStyle Music
 * @category    Web Components
 * @author      Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright   Copyright (c) 2014, Nazar Mokrynskyi
 * @license     MIT License, see license.txt
*/


(function() {
  var body, music_library, music_playlist;

  music_library = cs.music_library;

  music_playlist = cs.music_playlist;

  body = document.querySelector('body');

  Polymer('cs-music-playlist', {
    list: [],
    refresh: function() {
      var _this = this;
      return music_playlist.current(function(current_id) {
        return music_playlist.get_all(function(all) {
          var count, get_next_item, index, list;
          index = 0;
          list = [];
          count = all.length;
          get_next_item = function() {
            if (index < count) {
              return music_library.get_meta(all[index], function(data) {
                data.playing = data.id === current_id ? 'yes' : 'no';
                list.push(data);
                ++index;
                return get_next_item();
              });
            } else {
              return _this.list = list;
            }
          };
          return get_next_item();
        });
      });
    },
    play: function(e) {
      var _this = this;
      return music_playlist.current(function(old_id) {
        music_playlist.set_current(e.impl.target.dataset.index);
        return music_playlist.current(function(id) {
          if (id !== old_id) {
            _this.list.forEach(function(data, index) {
              if (data.id === old_id) {
                return _this.list[index].playing = 'no';
              } else if (data.id === id) {
                return _this.list[index].playing = 'yes';
              }
            });
            return document.querySelector('cs-music-player').play(id);
          } else {
            _this.list = [];
            return setTimeout((function() {
              return $(body).removeClass('playlist');
            }), 200);
          }
        });
      });
    }
  });

}).call(this);
